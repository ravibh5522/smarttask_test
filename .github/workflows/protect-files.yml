name: ğŸ›¡ï¸ Protect Critical Files
on:
  pull_request:
    paths:
      - 'README.md'
      - 'LICENSE'
      - 'COPYRIGHT'
      - 'CONTRIBUTING.md'
      - 'SECURITY.md'
      - 'CODE_OF_CONDUCT.md'
      - 'CHANGELOG.md'
      - 'SUPPORT.md'
      - '.github/**'
      - 'package.json'
      - 'tsconfig*.json'
      - 'vite.config.ts'
      - 'tailwind.config.ts'
      - 'eslint.config.js'
      - 'postcss.config.js'
      - 'components.json'
      - '*.md'
      - 'docs/**'
      - '.gitignore'
      - '.env*'
      - 'supabase/config.toml'
      - 'bun.lockb'
      - 'yarn.lock'
      - 'package-lock.json'
  push:
    paths:
      - 'README.md'
      - 'LICENSE'
      - 'COPYRIGHT'
      - 'CONTRIBUTING.md'
      - 'SECURITY.md'
      - 'CODE_OF_CONDUCT.md'
      - 'CHANGELOG.md'
      - 'SUPPORT.md'
      - '.github/**'
      - 'package.json'
      - 'tsconfig*.json'
      - 'vite.config.ts'
      - 'tailwind.config.ts'
      - 'eslint.config.js'
      - 'postcss.config.js'
      - 'components.json'
      - '*.md'
      - 'docs/**'
      - '.gitignore'
      - '.env*'
      - 'supabase/config.toml'
      - 'bun.lockb'
      - 'yarn.lock'
      - 'package-lock.json'

jobs:
  protect-critical-files:
    runs-on: ubuntu-latest
    name: ğŸš« Block Critical File Changes
    
    steps:
    - name: ï¿½ STRICT ACCESS CONTROL - OWNER ONLY
      run: |
        echo "ğŸš¨ CRITICAL FILE MODIFICATION DETECTED!"
        echo ""
        echo "ğŸ” STRICT ACCESS POLICY:"
        echo "   âš ï¸  ONLY the repository owner can modify these files"
        echo "   ğŸ‘¤ Authorized User: ravibh5522 (Ravi Kumar)"
        echo "   ğŸš« Current Actor: ${{ github.actor }}"
        echo ""
        if [[ "${{ github.actor }}" != "ravibh5522" ]]; then
          echo "âŒ ACCESS DENIED - UNAUTHORIZED USER!"
          echo ""
          echo "ğŸ“‹ Protected Files Include:"
          echo "   â€¢ ğŸ“– README.md - Project documentation"
          echo "   â€¢ âš–ï¸  LICENSE - Proprietary license agreement"
          echo "   â€¢ ğŸ“„ COPYRIGHT - Intellectual property notices"
          echo "   â€¢ ğŸ”§ .github/ - Repository configuration"
          echo "   â€¢ ï¿½ package.json - Project dependencies"
          echo "   â€¢ âš™ï¸  Configuration files (tsconfig, vite, etc.)"
          echo "   â€¢ ğŸ“ Documentation files (*.md)"
          echo "   â€¢ ğŸ—ƒï¸  Database configuration"
          echo "   â€¢ ğŸ” Environment files"
          echo ""
          echo "ğŸ¢ PROPRIETARY SOFTWARE NOTICE:"
          echo "   This is proprietary software owned by Ravi Kumar."
          echo "   Unauthorized modification of protected files is prohibited."
          echo "   Contributors can only modify source code in /src/ directory."
          echo ""
          echo "ğŸ“ Contact Information:"
          echo "   â€¢ GitHub: @ravibh5522"
          echo "   â€¢ Repository: smarttask-iq"
          echo "   â€¢ Access Policy: See BRANCH_PROTECTION.md"
          echo ""
          echo "ğŸ”„ To Request Access:"
          echo "   1. Use the access request template in issues"
          echo "   2. Provide business justification"
          echo "   3. Wait for owner approval"
          echo ""
          echo "âŒ THIS PULL REQUEST WILL BE AUTOMATICALLY REJECTED."
          exit 1
        else
          echo "âœ… ACCESS GRANTED - Authorized owner detected"
          echo "ğŸ‘¤ Welcome back, Ravi Kumar (@ravibh5522)"
          echo "ğŸ”“ You have full access to modify all protected files"
        fi
        echo "   â€¢ CONTRIBUTING.md"
        echo "   â€¢ SECURITY.md"
        echo "   â€¢ CODE_OF_CONDUCT.md"
        echo "   â€¢ CHANGELOG.md"
        echo "   â€¢ SUPPORT.md"
        echo "   â€¢ .github/ configuration files"
        echo "   â€¢ package.json"
        echo "   â€¢ Configuration files (tsconfig.json, vite.config.ts, etc.)"
        echo ""
        echo "ğŸ‘¥ Only the following users can modify these files:"
        echo "   â€¢ Ravi Kumar (@ravibh5522) - Project Owner & Tech Lead"
        echo "   â€¢ Gaurav Kumar - Stakeholder & Full Stack Developer"
        echo "   â€¢ Raghav Gulati - Stakeholder & Full Stack Developer"
        echo ""
        echo "ğŸ”’ This is a proprietary project with protected intellectual property."
        echo "ğŸ“ Contact @ravibh5522 for authorization or questions."
        echo ""
        echo "âŒ This pull request will be automatically rejected."
        exit 1

    - name: ğŸ“ Add comment to PR
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## ğŸ›¡ï¸ Protected Files Modification Detected

          ğŸš« **This pull request modifies protected files that require owner authorization.**

          ### ğŸ“‹ Protected Files Include:
          - ğŸ“– README.md
          - âš–ï¸ LICENSE
          - ğŸ“ Documentation files (CONTRIBUTING.md, SECURITY.md, etc.)
          - ğŸ”§ GitHub configuration files
          - ğŸ“¦ Package configuration files

          ### ğŸ‘¥ Authorization Required From:
          - **Ravi Kumar** (@ravibh5522) - Project Owner & Tech Lead
          - **Gaurav Kumar** - Stakeholder & Full Stack Developer  
          - **Raghav Gulati** - Stakeholder & Full Stack Developer

          ### ğŸ”„ Next Steps:
          1. Contact project owners for authorization
          2. Remove protected file changes from this PR
          3. Submit changes to protected files separately with owner approval

          **ğŸ”’ This is a proprietary project with protected intellectual property.**

          ---
          *Automated protection by SmartTask IQ repository rules*`
          })

  check-author-permissions:
    runs-on: ubuntu-latest
    name: ğŸ” Check Author Permissions
    
    steps:
    - name: âœ… Check if author is authorized
      run: |
        AUTHOR="${{ github.event.pull_request.user.login }}"
        
        # List of authorized users (project owners)
        AUTHORIZED_USERS=("ravibh5522")
        
        echo "ğŸ” Checking authorization for user: $AUTHOR"
        
        # Check if user is in authorized list
        for user in "${AUTHORIZED_USERS[@]}"; do
          if [ "$AUTHOR" = "$user" ]; then
            echo "âœ… User $AUTHOR is authorized to modify protected files"
            echo "ğŸ‘‘ Project Owner permissions confirmed"
            exit 0
          fi
        done
        
        echo "ğŸš« User $AUTHOR is NOT authorized to modify protected files"
        echo "ğŸ“ Contact @ravibh5522 for authorization"
        exit 1

# Note: This workflow protects critical SmartTask IQ files
# Only project owners can modify documentation and licensing files
# Unauthorized changes will be automatically rejected
